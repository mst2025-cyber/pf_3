<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>クリック展開式マインドマップ (樹状)</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #fafafa;
        font-family: 'Inter', sans-serif;
    }

    text {
        font-size: 14px;
        fill: #333;
        cursor: pointer;
        user-select: none;
        transition: font-size 0.5s, fill 0.5s;
    }

    circle {
        fill: #fff;
        stroke: #4A90E2;
        stroke-width: 2px;
        cursor: pointer;
        transition: all 0.5s;
    }

    /* ノードが閉じているときの色を濃くする */
    .node circle {
        fill: #fff;
        stroke: #4A90E2;
    }
    .node--internal circle {
        fill: #4A90E2;
        stroke: #1C5B9E;
    }
    .node--root circle {
        fill: #1C5B9E;
        stroke: #1C5B9E;
    }

    .link {
        fill: none;
        stroke: #bbb;
        stroke-width: 2px;
        transition: stroke 0.5s;
    }
</style>
</head>
<body>

<!-- ▼ D3.js（CDN） -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<script>
//------------------------------------
// マインドマップデータ
//------------------------------------
const treeData = {
    name: "Masato's Mindmap",
    children: [
        {
            name: "生成AI初級ゼミ",
            children: [
                { name: "面白画像の生成" },
                { name: "面白動画の生成" },
                { name: "AIを利用した絵本の作成" },
                { name: "動画生成AIを使う" }
            ]
        },
        {
            name: "生成AI中級ゼミ",
            children: [
                { name: "バイブコーディングによるアプリ開発"},    
                { name: "difyハンズオンセミナー",
                    children: [                
                        { name: "第1回：Dify導入と環境構築" },
                        { name: "第2回：LLMノードとプロンプト設計" },
                        { name: "第3回：Knowledge（RAG）とドキュメント連携"},
                        { name: "第4回：エージェントと外部連携" },
                        { name: "第5回：デプロイ・運用・発表" }
                    ]
                }
            ]
        },
        {
            name: "プロンプトゼミ",
            children: [
                { name: "詳細 1-1" },
                { name: "詳細 1-2" },
                { name: "詳細 1-3" },
                { name: "詳細 1-4" }
            ]
        },
        {
            name: "WEBマーケティングゼミ",
            children: [
                { name: "「作って終わり」ではない！ビジネスを成長させるウェブサイト運営の全技術" },
                { name: "「GA4と広告」連携 超入門セミナー" },
                { name: "LLMO × SEO" },
                { name: "「GA4と広告」連携 超入門セミナー" },
                { name: "【GEMINI x GA4】勘から確信へ！WEBマーケティング業務効率化ゼミ" },                { name: "「GA4と広告」連携 超入門セミナー" },                { name: "「GA4と広告」連携 超入門セミナー" },
                { name: "第一回WEBマーケティング（広告）ゼミ" },
                { name: "第2回：【デモ中心】検索キャンペーンを作成しよう" },
                { name: "Google広告UIゼミ" },
                { name: "「GA4と広告」連携 超入門セミナー" },
                { name: "「GA4と広告」連携 超入門セミナー" },
                { name: "Webマーケティング全体像とSNSの役割" }
            ]
        },
        {
            name: "Gemini業務効率化ゼミ",
            children: [
                { name: "詳細 1-1" },
                { name: "詳細 1-2" },
                { name: "詳細 1-3" },
                { name: "詳細 1-4" }
            ]
        },
        {
            name: "DB関連ゼミ",
            children: [
                { name: "詳細 2-1" },
                { name: "詳細 2-2" }
            ]
        },
        {
            name: "pythonゼミ",
            children: [
                { name: "詳細 1-1" },
                { name: "詳細 1-2" },
                { name: "詳細 1-3" },
                { name: "詳細 1-4" }
            ]
        },
        {
        
            name: "ゼミ数学ゼミ",
            children: [
                { name: "詳細 1-1" },
                { name: "詳細 1-2" },
                { name: "詳細 1-3" },
                { name: "詳細 1-4" }
            ]
        },
        {
            name: "アイデア 2",
            children: [
                { name: "詳細 2-1" },
                { name: "詳細 2-2" }
            ]
        },
        {
           name: "アイデア 2",
            children: [
                { name: "詳細 2-1" },
                { name: "詳細 2-2" }
            ]
        },
        {
            name: "アイデア 3",
            children: [
                { name: "詳細 3-1" }
            ]
        }
    ]
};

//------------------------------------
// SVGセットアップ
//------------------------------------
const margin = {top: 20, right: 90, bottom: 30, left: 90};
const width = window.innerWidth - margin.left - margin.right;
const height = window.innerHeight - margin.top - margin.bottom;
let i = 0; // ノードIDのためのカウンタ

const svg = d3.select("body")
    .append("svg")
    .attr("width", width + margin.right + margin.left)
    .attr("height", height + margin.top + margin.bottom);

// ツリーを左から展開するため、左側にマージンを設定してグループを配置
const g = svg.append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

// レイアウト設定（樹状。xが垂直方向、yが水平方向になる）
const tree = d3.tree()
    .size([height, width]); // [高さ, 幅]

// リンクジェネレータを定義 (d3.linkHorizontalを使用し、曲線パスを生成)
const linkGenerator = d3.linkHorizontal()
    .x(d => d.y) // x座標としてd.y（深さ）を使用
    .y(d => d.x); // y座標としてd.x（ノード間の垂直位置）を使用

// ルートノード作成
let root = d3.hierarchy(treeData);
root.x0 = height / 2; // 初期位置を画面中央に設定
root.y0 = 0;

// 初期状態：中央テーマの直下のみ展開
// root.children.forEach(collapse); // すべて閉じる代わりに、最初のレベルは展開したままにする
update(root);

// 画面リサイズ時の対応
window.addEventListener('resize', () => {
    // 完全にリセットするのではなく、レイアウトを再計算する
    const newWidth = window.innerWidth - margin.left - margin.right;
    const newHeight = window.innerHeight - margin.top - margin.bottom;

    svg.attr("width", newWidth + margin.right + margin.left)
       .attr("height", newHeight + margin.top + margin.bottom);

    tree.size([newHeight, newWidth]);
    update(root);
});

//------------------------------------
// 関数：子を閉じる
//------------------------------------
function collapse(d) {
    if (d.children) {
        d._children = d.children;
        d._children.forEach(collapse);
        d.children = null;
    }
}

//------------------------------------
// 描画更新（重要）
//------------------------------------
function update(source) {
    // レイアウト計算
    const treeLayout = tree(root);

    const nodes = treeLayout.descendants();
    const links = treeLayout.links();

    // ノード間のスペースを調整 (yの値を深くする)
    nodes.forEach(d => { d.y = d.depth * 240; }); // 1レベルあたり180px

    //------------------------------------
    // ノード（circle + text）
    //------------------------------------
    const node = g.selectAll("g.node")
        .data(nodes, d => d.id || (d.id = ++i));

    // Enter: 新しいノードの初期位置を親ノード（source）に設定
    const nodeEnter = node.enter()
        .append("g")
        .attr("class", d => `node ${d.children ? "node--internal" : "node--leaf"} ${d.depth === 0 ? "node--root" : ""}`)
        // ノードの初期位置を親ノードの位置（またはソースノード）に設定
        .attr("transform", d => `translate(${source.y0},${source.x0})`)
        .on("click", (e, d) => {
            // 子がいれば開閉
            if (d.children) {
                d._children = d.children;
                d.children = null;
            } else {
                d.children = d._children;
                d._children = null;
            }
            update(d);
        });

    // ノードの円
    nodeEnter.append("circle")
        .attr("r", 0); // 初期サイズを0にしてアニメーションで展開

    // ノードのテキスト
    nodeEnter.append("text")
        .attr("dy", "0.31em")
        .attr("x", d => d.children || d._children ? -12 : 12) // 子を持つノードは左寄せ、末端は右寄せ
        .attr("text-anchor", d => d.children || d._children ? "end" : "start")
        .text(d => d.data.name);

    //------------------------------------
    // ノード更新位置とスタイル
    //------------------------------------
    const nodeUpdate = nodeEnter.merge(node);

    // Update: ノードを新しい計算位置へ移動
    nodeUpdate.transition()
        .duration(500)
        .attr("transform", d => `translate(${d.y},${d.x})`); // (y, x) 座標を使用
    
    // 階層に基づいたノードのスタイル設定
    nodeUpdate.select("circle")
        .transition()
        .duration(500)
        .attr("r", d => d.depth === 0 ? 12 : 8) // サイズを階層に応じて変更
        .style("stroke-width", d => d.children || d._children ? "2px" : "1px")
        .style("fill", d => d.children || d._children ? "#4A90E2" : "#fff"); // 閉じているノードは濃い青

    nodeUpdate.select("text")
        .style("font-size", d => d.depth === 0 ? "18px" : "14px") // 中央テーマを大きく
        .attr("x", d => d.children || d._children ? -12 : 12)
        .attr("text-anchor", d => d.children || d._children ? "end" : "start")
        .style("fill", d => d.depth === 0 ? "#fff" : "#333"); // 中央テーマは白いテキスト
    
    //------------------------------------
    // ノード削除
    //------------------------------------
    const nodeExit = node.exit().transition()
        .duration(500)
        // 削除ノードを親ノードの位置に戻す（折りたたみアニメーション）
        .attr("transform", d => `translate(${source.y},${source.x})`)
        .remove();

    nodeExit.select("circle").attr("r", 0); // 円を縮小

    //------------------------------------
    // リンク（線）
    //------------------------------------
    const link = g.selectAll("path.link")
        .data(links, d => d.target.id);

    // Enter: 親ノードの位置から開始
    const linkEnter = link.enter()
        .append("path")
        .attr("class", "link")
        // 初期は親ノードの位置でリンクを生成
        .attr("d", d => linkGenerator({ source: source, target: source })); 

    // Update: 正しい位置へトランジション
    linkEnter.merge(link).transition()
        .duration(500)
        .attr("d", linkGenerator) // linkGenerator を使用
        // リンクの色も階層に応じて調整
        .style("stroke", d => d.source.depth === 0 ? "#4A90E2" : "#bbb");


    // 削除: 親ノードの位置へ戻って消える
    link.exit().transition()
        .duration(500)
        .attr("d", d => linkGenerator({ source: source, target: source }))
        .remove();

    //------------------------------------
    // 現在位置を保存
    //------------------------------------
    nodes.forEach(d => {
        d.x0 = d.x;
        d.y0 = d.y;
    });
}
</script>

</body>
</html>